 @model ProductVM

@{
    @*int count = 0;
        @foreach (Review review in Model.Reviews)
        {
            count += 1;
        }*@
    ViewData["Title"] = "Detail";
    string tags = "";
}
<style>
    * {
        font-family: "Lato";
    }


    .product-review-stars {
        padding: 20px 50px 20px 20px;
        width: 335px !important;
    }

        .product-review-stars label {
            text-shadow: 0px 0px 10px black;
        }

    .visuallyhidden {
        position: absolute !important;
        clip: rect(1px 1px 1px 1px);
        clip: rect(1px, 1px, 1px, 1px);
    }

    .product-review-stars label:after {
        content: "★";
        color: inherit;
        -webkit-transform: scale(4);
        position: absolute;
        z-index: 4;
        left: 0px;
        transition: all .4s;
        opacity: 0;
        color: inherit;
        visibility: hidden;
    }

    .product-review-stars input:checked + label:after {
        visibility: visible;
        -webkit-transform: scale(1);
        opacity: 1;
    }

    .product-review-stars {
        unicode-bidi: bidi-override;
        direction: rtl;
        width: 335px !important;
    }

        .product-review-stars label {
            font-family: "icomoon";
            font-size: 2em;
            position: relative;
            cursor: pointer;
            color: #DFE3E4;
        }

        .product-review-stars input:checked ~ label:before {
            opacity: 1;
        }

        .product-review-stars:hover input ~ label:before {
            opacity: 0;
        }

        .product-review-stars input + label:before {
            content: "\2605";
            position: absolute;
            right: 0;
            opacity: 0;
            transition: opacity .3s ease-in-out, color .3s ease-in-out;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden; /* Chrome and Safari */
            -moz-backface-visibility: hidden; /* Firefox */
            -ms-backface-visibility: hidden; /* Internet Explorer */
        }

        .product-review-stars input + label:hover:before,
        .product-review-stars input + label:hover ~ label:before {
            opacity: 1;
        }

        .product-review-stars input + label:nth-of-type(1):after,
        .product-review-stars input + label:nth-of-type(1):before,
        .product-review-stars input + label:nth-of-type(1):hover:before,
        .product-review-stars input + label:nth-of-type(1):hover ~ label:before,
        .product-review-stars input:nth-of-type(1):checked ~ label:before {
            color: #2ecc71;
        }

        .product-review-stars input + label:nth-of-type(2):after,
        .product-review-stars input + label:nth-of-type(2):before,
        .product-review-stars input + label:nth-of-type(2):hover:before,
        .product-review-stars input + label:nth-of-type(2):hover ~ label:before,
        .product-review-stars input:nth-of-type(2):checked ~ label:before {
            color: #f1c40f;
        }

        .product-review-stars input + label:nth-of-type(3):after,
        .product-review-stars input + label:nth-of-type(3):before,
        .product-review-stars input + label:nth-of-type(3):hover:before,
        .product-review-stars input + label:nth-of-type(3):hover ~ label:before,
        .product-review-stars input:nth-of-type(3):checked ~ label:before {
            color: #F39C12;
        }

        .product-review-stars input + label:nth-of-type(4):after,
        .product-review-stars input + label:nth-of-type(4):before,
        .product-review-stars input + label:nth-of-type(4):hover:before,
        .product-review-stars input + label:nth-of-type(4):hover ~ label:before,
        .product-review-stars input:nth-of-type(4):checked ~ label:before {
            color: #e74c3c;
        }

        .product-review-stars input + label:nth-of-type(5):after,
        .product-review-stars input + label:nth-of-type(5):before,
        .product-review-stars label:nth-of-type(5):hover:before,
        .product-review-stars input:nth-of-type(5):checked ~ label:before {
            color: #d35400;
        }

        .product-review-stars label:nth-of-type(5):hover:before {
            color: #d35400 !important;
        }
    .StarRate {
        color: #cfa86e;
        text-decoration: none;
        transition: 0.3s ease all;
        background: transparent;
        z-index: 1;
        font-size: 18px;
        font-weight: 500;
        font-family: "PT Sans", sans-serif;
        letter-spacing: 0.5px;
        line-height: normal;
        text-transform: capitalize;
        display: inline-block;
        text-align: center;
        padding: 10px 35px;
        border: 2px solid #cfa86e;
        border-radius: 0;
        position: relative;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.1);
        outline: none;
        margin-bottom: 50px;
        margin-left: 74px;
    }
    .StarRate::before {
        transition: 0.5s all ease;
        position: absolute;
        top: 0;
        left: 50%;
        right: 50%;
        bottom: 0;
        opacity: 0;
        content: "";
        background-color: #cfa86e;
        z-index: -2;
        box-sizing: border-box;
    }

    .StarRate:hover {
        color: #FFF;
        background: transparent;
    }

        .StarRate:hover::before {
            transition: 0.5s all ease;
            left: 0;
            right: 0;
            opacity: 1;
        }

    
   
</style>

<section class="shop">
    <div class="shop-text">
        <h1>Shop</h1>
        <a asp-controller="Home" asp-action="Index">Home</a>
        <i class="fa-solid fa-angle-right" style="font-size:17px; margin-left:5px; margin-right:5px;"></i>
        <a asp-controller="Shop" asp-action="Index"><span>Products</span></a>
    </div>
</section>
<section class="product-detail" style="margin:0px">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-12">
                <div class="image">
                    <img src="~/assets/img/meals/@Model.Product.Image" alt="">
                </div>
            </div>
            <div class="col-lg-6 col-12">
                <h2>@Model.Product.Name</h2>
                <p>@Model.Product.Description</p>
                <span>@Model.Product.Price ₼</span>
                <div class="amountcart">
                    <div class="productamount">
                        <a href=""><i class="fa-solid fa-minus"></i></a>
                        <span>1</span>
                        <a href=""><i class="fa-solid fa-plus"></i></a>
                    </div>
                    <a asp-controller="Product" asp-action="AddBasket" asp-route-id="@Model.Product.Id" class="addtocart" style="position: static; opacity: 1; visibility: visible;">Add to cart</a>
                </div>
                <h4>Category:<span>@Model.Product.Category.Name</span></h4>
                <h4>
                    Tag:<span>
                        @(tags = string.Join(", ", Model.Product.ProductTags.Select(p => p.Tag != null ? p.Tag.Name : "")))
                    </span>
                </h4>
            </div>
        </div>
    </div>
</section>
<section class="allreviews">
    <div class="product-info-tab-menu">
        <div class="tab">
            <button class="tablinks active"
                    onclick="openInfo(event, 'Description')"
                    id="defaultOpen">
                Description
            </button>
            <button class="tablinks" onclick="openInfo(event, 'Adittional')">Reviews</button>
        </div>
        <div id="Description" class="tabcontent">
            <h4>Description</h4>
            <p>@Model.Product.Description</p>
        </div>

        <div id="Adittional" class="tabcontent">
            <div class="reviewtable">
                <p>1 review for @Model.Product.Name</p>

                <div class="all-reviews">
                    @await Html.PartialAsync("_ReviewStarPartial", Model)
                </div>

                <h3>Add a Review</h3>
                <form>
                    <label for="Name">Name</label>
                    <br>
                    <input id="Name" name="Name">
                    <br>
                    <label for="Email">Email</label>
                    <br>
                    <input id="Email" name="Email" type="text">
                    <br>

                    <label for="Message">Your Review</label>
                    <br />
                    <input id="Message" name="Message" type="text">
                    <br />
                    <label for="Rating">Your Rating</label>
                    <br />
                    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
                    <div class="product-review-stars">
                        <input type="radio" id="star5" name="rating" value="5" class="visuallyhidden" /><label for="star5" title="Rocks!">★</label>
                        <input type="radio" id="star4" name="rating" value="4" class="visuallyhidden" /><label for="star4" title="Pretty good">★</label>
                        <input type="radio" id="star3" name="rating" value="3" class="visuallyhidden" /><label for="star3" title="Meh">★</label>
                        <input type="radio" id="star2" name="rating" value="2" class="visuallyhidden" /><label for="star2" title="Kinda bad">★</label>
                        <input type="radio" id="star1" name="rating" value="1" class="visuallyhidden" /><label for="star1" title="Sucks big time">★</label>
                    </div>
                    <br />
                    <a href="#" class="StarRate" data-id="@Model.Product.Id">Submit</a>
                </form>
            </div>
        </div>
    </div>
</section>
<section class="related">
    <h3>Related Products</h3>
    <div class="container">
        <div class="row">
            @foreach (Product product in Model.Products.Take(3))
            {
                @if (!product.IsDeleted)
                {
                    <div class="col-lg-4">
                        <div class="product-related">
                            <div class="imgcart">
                                <a asp-controller="Shop" asp-action="Detail"><img src="~/assets/img/meals/@product.Image" alt=""></a>
                                <a href="" class="addtocart">Add to cart</a>
                            </div>
                        </div>
                        <div class="product-text" style="height:120px;">
                            <h4>@product.Name</h4>
                            <span>@product.Price.ToString("F2")₼</span>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    var star;
    $(".visuallyhidden").click(function (e) {
        star = parseInt($(this).val());
    });
    $(document).ready(function () {
        $(".StarRate").click(function (e) {
            e.preventDefault();
            var id = $(this).attr("data-id");
            var message = $("#Message").val();
            fetch("../Product/Review" + "?rid=" + id + "&message=" + message + "&star=" + star).then(res => {
                return res.text()
            }).then(data => {
                if (data == 0) {
                    window.location = window.location.origin + "/Account/Login";
                    return;
                }
                $(".all-reviews").html(data);
            })
        })
    })
    $(document).on("click", ".deletecommentprod", function (e) {
        e.preventDefault();
        var id = $(this).attr("data-id");
        var bid = $(this).attr("data-bid");
        fetch("../Product/Delete" + "?id=" + id).then(res => {
            return res.text();
        }).then(data => {
            $(" .all-reviews").html(data);

           
        })
    })
</script>
